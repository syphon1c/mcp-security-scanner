# golangci-lint configuration for MCP Security Scanner
run:
  timeout: 5m
  modules-download-mode: readonly

linters:
  enable:
    - errcheck
    - gosimple
    - govet
    - ineffassign
    - staticcheck
    - typecheck
    - unused
    - gofmt
    - goimports
    - gosec
    - gocritic
    - misspell
    - revive
    - unconvert
    - whitespace
    # Disable problematic linters that would require extensive refactoring:
    # - unparam (disabled - too many false positives)
  disable:
    - unparam # Disabled due to too many false positives in legitimate code

linters-settings:
  gosec:
    # Enable all gosec rules
    includes:
      - G101 # Look for hard coded credentials
      - G102 # Bind to all interfaces
      - G103 # Audit the use of unsafe block
      - G104 # Audit errors not checked
      - G105 # Audit the use of big.Exp function
      - G106 # Audit the use of ssh.InsecureIgnoreHostKey
      - G107 # Url provided to HTTP request as taint input
      - G108 # Profiling endpoint automatically exposed on /debug/pprof
      - G109 # Potential Integer overflow made by strconv.Atoi result conversion to int16/32
      - G110 # Potential DoS vulnerability via decompression bomb
      - G201 # SQL query construction using format string
      - G202 # SQL query construction using string concatenation
      - G203 # Use of unescaped data in HTML templates
      - G204 # Audit use of command execution
      - G301 # Poor file permissions used when creating a directory
      - G302 # Poor file permissions used with chmod
      - G303 # Creating tempfile using a predictable path
      - G304 # File path provided as taint input
      - G305 # File traversal when extracting zip/tar archive
      - G306 # Poor file permissions used when writing to a new file
      - G307 # Deferring a method which returns an error
      - G401 # Detect the usage of DES, RC4, MD5 or SHA1
      - G402 # Look for bad TLS connection settings
      - G403 # Ensure minimum RSA key length of 2048 bits
      - G404 # Insecure random number source (rand)
      - G501 # Import blocklist: crypto/md5
      - G502 # Import blocklist: crypto/des
      - G503 # Import blocklist: crypto/rc4
      - G504 # Import blocklist: net/http/cgi
      - G505 # Import blocklist: crypto/sha1
      - G601 # Implicit memory aliasing of items from a range statement

  gocritic:
    enabled-tags:
      - diagnostic
      - style
      - performance
    disabled-checks:
      - unnamedResult # Allow unnamed returns for brevity
      - hugeParam # Skip huge parameter warnings - would require extensive refactoring
      - rangeValCopy # Skip range value copy warnings - would require extensive refactoring
      - commentedOutCode # Skip commented code warnings
      - ifElseChain # Skip if-else chain warnings 
      - appendCombine # Skip append combine warnings
      - builtinShadowDecl # Skip builtin shadow warnings
      - emptyStringTest # Skip empty string test warnings
      - regexpSimplify # Skip regexp simplify warnings
      - paramTypeCombine # Skip param type combine warnings
      - nestingReduce # Skip nesting reduce warnings
      - elseif # Skip elseif warnings
      - httpNoBody # Skip httpNoBody warnings
      - exitAfterDefer # Skip exit after defer warnings in test scripts
      - appendAssign # Skip append assign warnings

  revive:
    rules:
      - name: exported
        disabled: true # Allow unexported in some cases

issues:
  exclude-dirs:
    - scripts  # Skip scripts directory with standalone Go programs
  exclude-rules:
    # Exclude some linters from running on tests files
    - path: _test\.go
      linters:
        - gosec
        - errcheck
        - unparam
    
    # Exclude test directory completely from errcheck
    - path: test/.*
      linters:
        - errcheck
        - gosec
        - unparam
        - gocritic
    
    # Exclude scripts directory completely
    - path: scripts/.*
      linters:
        - typecheck
        - unused
        - errcheck
        - gosec
        - govet
        - staticcheck
        - unparam
        - gocritic
    
    # Exclude G204 (command execution) from our security scanner - it's intentional
    - path: internal/scanner/
      text: "G204:"
      linters:
        - gosec
        
    # Exclude G304 (file path injection) from scanner - it's controlled
    - path: internal/scanner/
      text: "G304:"
      linters:
        - gosec
    
    # Exclude unparam issues from test files and PDF generation
    - path: internal/reporting/pdf\.go
      linters:
        - unparam
    
    # Exclude unparam issues from MCP vulnerability testing
    - path: internal/scanner/mcp_vulnerabilities\.go
      linters:
        - unparam
        
    # Exclude staticcheck issues from test files using deprecated packages
    - path: test/.*\.go
      text: "SA1019.*ioutil.*deprecated"
      linters:
        - staticcheck
    
    # Exclude ineffassign from analyzer files where assignments may be intentional
    - path: internal/analyzer/
      linters:
        - ineffassign
        
    # Exclude gosimple nil check warnings where they add clarity
    - path: internal/
      text: "S1009.*should omit nil check"
      linters:
        - gosimple
